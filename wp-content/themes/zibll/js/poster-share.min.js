const poster=function(){function t(t){const a=document.querySelector(t.selector),d=n("div","id","wrapper"),g=n("canvas","id","canvas","block"),h=n("canvas","id","day"),f=n("canvas","id","date"),p=n("canvas","id","title"),u=n("canvas","id","content"),y=n("canvas","id","tags"),w=n("canvas","id","logo"),b=n("canvas","id","description");i(d,g,h,f,p,u,w,y,b),a.appendChild(d);const m=new Date;$weekarray=["日","一","二","三","四","五","六"];const x={font:"35px Arial",color:"rgba(255, 255, 255, 1)",position:"left"};r(h,x,"周"+$weekarray[m.getDay()]);const S={font:"28px Arial",color:"rgba(255, 255, 255, 1)",position:"left"};r(f,S,m.getMonth()+1+" / "+m.getDate());const v={font:"bold 35px Arial",lineHeight:1.5,color:"rgba(66, 66, 66, 1)",length:2,position:"left"};v.font=t.titleStyle&&t.titleStyle.font||v.font,v.color=t.titleStyle&&t.titleStyle.color||v.color,v.position=t.titleStyle&&t.titleStyle.position||v.position,l(p,v,t.title);const R={font:"25px Arial",lineHeight:1.5,position:"left",color:"rgba(88, 88, 88, 1)"};R.font=t.contentStyle&&t.contentStyle.font||R.font,R.color=t.contentStyle&&t.contentStyle.color||R.color,R.lineHeight=t.contentStyle&&t.contentStyle.lineHeight||R.lineHeight,R.position=t.contentStyle&&t.contentStyle.position||R.position,l(u,R,t.content);const A={font:"24px Roboto Slab",position:"left",color:"rgb(252, 78, 31)"};A.color=t.tagsStyle&&t.tagsStyle.color||A.color,l(y,A,t.tags);const k={font:"22px Arial",color:"rgba(180, 180, 180, 1)",lineHeight:1.2,position:"center"};l(b,k,t.description);const I=new Image;I.crossOrigin="Anonymous";const _=new Image;_.crossOrigin="Anonymous",_.src=t.logo;const H=new Image;H.src=t.qrcode;var T=0;const q=function(){0==T&&(t.banner?I.src=t.banner:T=1),1==T&&(t.banner_default?I.src=t.banner_default:T=2),2==T&&(I.src=t.banner_spare),C()},C=function(){g.width=s,g.height=c,I.onload=function(){const n=g.getContext("2d");n.fillStyle="rgba(255, 255, 255, 1)",n.fillRect(0,0,g.width,g.height),imgRect=o(g.width,g.height/2,I.width,I.height),n.drawImage(I,imgRect.sx,imgRect.sy,imgRect.sWidth,imgRect.sHeight,0,0,g.width,g.height/2),n.drawImage(h,0,35),n.drawImage(f,0,85),n.strokeStyle="#00a1ff",n.lineWidth=7,n.beginPath(),n.lineCap="round",n.moveTo(40,g.height/2+38),n.lineTo(40,g.height/2+74),n.stroke(),n.drawImage(p,20,g.height/2+40),n.drawImage(y,0,g.height/2+160),n.drawImage(u,0,g.height/2+220),n.strokeStyle="rgba(122, 122, 122, 0.3)",n.lineWidth=2,n.rect(30,g.height-230,g.width-60,200),n.stroke(),logoRect=e(80,g.height-190,300,100,_.width,_.height),n.drawImage(_,logoRect.dx,logoRect.dy,logoRect.dWidth,logoRect.dHeight),n.drawImage(H,g.width-200,g.height-200,120,120),n.drawImage(b,0,g.height-60);const i=new Image;i.crossOrigin="Anonymous",i.src=g.toDataURL("image/png");const r=t.radio||.7;i.width=s*r,i.height=c*r,n.clearRect(0,0,g.width,g.height),g.style.display="none",a.appendChild(i),a.removeChild(d),a.classList.add("loaded"),$.isFunction(t.callback)&&t.callback(a)},I.onerror=function(e){if(T++,T>=3)return $.isFunction(t.onerror)&&t.onerror(a);q()}};q()}function e(t,e,o,n,i,r){var l=t,a=e,s=o,c=n;return i>r||i==r&&o<n?(c=r*s/i,a=e+(n-c)/2):(i<r||i==r&&o>n)&&(s=i*c/r,l=t+(o-s)/2),{dx:l,dy:a,dWidth:s,dHeight:c}}function o(t,e,o,n){var i=0,r=0,l=o,a=n;return o>n||o==n&&t<e?(l=t*a/e,i=(o-l)/2):(o<n||o==n&&t>e)&&(a=e*l/t,r=(n-a)/2),{sx:i,sy:r,sWidth:l,sHeight:a}}function n(t,e,o,n="none"){const i=document.createElement(t);return i.setAttribute(e,o),i.style.display=n,i.width=s,i}function i(t,...e){e.forEach(e=>{t.appendChild(e)})}function r(t,e,o){const n=t.getContext("2d");t.height=parseInt(e.font.match(/\d+/),10)+20,n.font=e.font,n.fillStyle=e.color,n.textBaseline="top";let i=0,r=0,l=!1;for(let e=0;e<o.length;e++)if(i+=n.measureText(o[e]).width,i>t.width-60){l=!0,r=e;break}let s=30;l&&(o=o.substring(0,r),s=t.width/2-i/2),a&&(n.strokeStyle="#6fda92",n.strokeRect(0,0,t.width,t.height)),"center"===e.position?(n.textAlign="center",n.fillText(o,t.width/2,2)):"left"===e.position?n.fillText(o,s,2):(n.textAlign="right",n.fillText(o,t.width-s,2))}function l(t,e,o){const n=t.getContext("2d"),i=parseInt(e.font.match(/\d+/),10);a&&(n.strokeStyle="#6fda92",n.strokeRect(0,0,t.width,t.height)),n.font=e.font,n.fillStyle=e.color,n.textBaseline="top",n.textAlign="center";let r=0;"center"===e.position?r=t.width/2:"left"===e.position?(n.textAlign="left",r=40):(n.textAlign="right",r=t.width-40);let l=0,s=0,c=2;for(let a=0;a<o.length;a++)l+=n.measureText(o[a]).width,l>t.width-120&&(n.fillText(o.substring(s,a),r,c),c+=i*e.lineHeight,l=0,s=a),a===o.length-1&&n.fillText(o.substring(s,a+1),r,c)}const a=0,s=768,c=1168;return{init:t}}();if($(".poster-imgbox").length){var qrcanvas=$(".qrcode canvas")[0].toDataURL("image/png");function posterDownload(t){if(null==t)return;const e=t.querySelector(".poster-download"),o=t.querySelector("img");e.setAttribute("href",o.getAttribute("src"))}poster.init({banner:_poster.banner,banner_default:_poster.banner_default,banner_spare:_poster.banner_spare,selector:".poster-imgbox",title:_poster.title,content:_poster.content,logo:_poster.logo,tags:_poster.tags,description:_poster.description,qrcode:qrcanvas,onerror:function(t){$(t).find(".poster-loading").html('<div class="c-red box-body" style="font-size:60px;"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i></div><div class="c-red box-body">海报加载失败</div>')},callback:posterDownload})}