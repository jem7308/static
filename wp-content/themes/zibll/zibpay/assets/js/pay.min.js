function pay_action_ajax(a,o){$(".modal:not(#modal_pay)").modal("hide"),modal=$("#modal_pay"),modal.length&&modal.modal("show").find(".pay-payment").removeClass("wechat alipay").addClass(a.pay_type),modal.find(".more-html").remove(),pay_ajax_notice("正在生成订单，请稍候","load"),modal.length||(notyf("加载中，请稍等...","load","","pay_ajax"),a.get_modal=1),$.ajax({type:"POST",url:pay_ajax_url,data:a,dataType:"json",error:function(a){notyf("操作失败 "+a.status+" "+a.statusText+"，请刷新页面后重试","danger","","pay_ajax")},success:function(a){(a.msg||!modal.length)&&notyf(a.msg||"请扫码付款，付款成功后会自动跳转",a.ys?a.ys:a.error?"danger":"","",modal.length?"":"pay_ajax"),modal.length||(_body.append(a.pay_modal),auto_fun(),modal=$("#modal_pay"),modal.modal("show")),a.error?(pay_ajax_notice(a.msg?a.msg:"处理失败,即将刷新页面","danger"),setTimeout(function(){location.reload()},2e3)):(order_result=a,is_verify||(verify_pay(),is_verify=!0)),a.order_name&&modal.find(".pay-title").html(a.order_name),a.order_price&&modal.find(".pay-price").html(a.order_price),a.payment_method&&modal.find(".pay-payment").removeClass("wechat alipay").addClass(a.payment_method),a.more_html&&!a.open_url&&modal.find(".pay-notice").before('<div class="more-html">'+a.more_html+"</div>"),a.url_qrcode&&!a.open_url&&(qrcode_box=modal.find(".pay-qrcode img"),qrcode_box.attr("src",a.url_qrcode).css({filter:"blur(0)",opacity:"1",transition:"all 0.3s ease 0.5s"}),pay_ajax_notice("请扫码付款，付款成功后会自动跳转","")),a.url&&a.open_url&&(window.location.href=a.url,window.location.reload),a.url||a.url_qrcode||pay_ajax_notice(a.msg?a.msg:"支付配置错误","danger")}})}function pay_ajax_notice(a,o){notice_box=$("#modal_pay").find(".pay-notice .notice"),a="load"==o?'<i class="loading mr6"></i>'+a:a,notice_box.removeClass("load warning success danger").addClass(o).html(a)}function verify_pay(){order_result.order_num&&$.ajax({type:"POST",url:pay_ajax_url,data:{action:"check_pay",post_id:pay_inputs.post_id,order_num:order_result.order_num},dataType:"json",success:function(a){"1"==a.status?(pay_ajax_notice("付款成功，页面跳转中","success"),setTimeout(function(){void 0!==pay_inputs.return_url&&pay_inputs.return_url?(window.location.href=pay_inputs.return_url,window.location.reload):location.reload()},500)):setTimeout(function(){verify_pay()},2e3)}})}var pay_ajax_url=_win.ajax_url,order_result={},pay_inputs={},_body=$("body"),is_verify=!1;_body.on("click",".initiate-pay-switch",function(a){var o=$(this);return pay_inputs.pay_type=o.attr("pay_type"),pay_action_ajax(pay_inputs,o),o.parents(".pay-payment").find(".pay-qrcode img").css({filter:"blur(5px)",opacity:".8",transition:"all 0.3s"}),!1}),_body.on("click",".initiate-pay",function(a){var o=$(this),e=o.parents("form");return pay_inputs=e.serializeObject(),pay_inputs.pay_type=o.attr("pay_type"),pay_inputs.return_url||(pay_inputs.return_url=window.location.href),pay_action_ajax(pay_inputs,o),!1}),_body.on("click",".pay-vip",function(a){var o=$(this);return _modal='<div class="modal fade" id="modal_pay_uservip" tabindex="-1" role="dialog" aria-hidden="false">    <div class="modal-dialog" role="document">    <div class="modal-content">    <div class="loading zts"></div>    </div>    </div>    </div>    </div>',$("#modal_pay_uservip").length||_body.append(_modal),auto_fun(),modal=$("#modal_pay_uservip"),vip_level=o.attr("vip-level"),modal.find(".payvip-modal").length?($('a[href="#tab-payvip-'+vip_level+'"]').tab("show"),modal.modal("show")):(notyf("加载中，请稍等...","load","","payvip_ajax"),$.ajax({type:"POST",url:pay_ajax_url,data:{action:"pay_vip",vip_level:vip_level},dataType:"json",success:function(a){a.msg&&notyf(a.msg,a.ys?a.ys:a.error?"danger":"","","payvip_ajax"),a.error||modal.find(".modal-content").html(a.html),modal.modal("show"),notyf("请选择会员选项","",3,"payvip_ajax")}})),!1});